package classification;

import android.util.Log;

import org.opencv.core.CvType;
import org.opencv.core.Mat;
import org.opencv.ml.SVM;

public class Classifier {
    private static final String TAG = "Classifier";

    private final int inputSize = 128;
    private Mat samples = new Mat(1, inputSize, CvType.CV_32F);
    private Mat results = new Mat();
    private SVM svm;

    private Classifier() {}

    public static Classifier create(String modelFilename) {
        Classifier c = new Classifier();
        c.svm = SVM.load(modelFilename);
        return c;
    }

    public int classify(final float[] embeddings) {
        double [] d = {0.03922994, -0.13700813, -0.03999786,  0.07803909,  0.00844743,
                -0.09049205, -0.10569718,  0.15139584,  0.06980007,  0.02681557,
                -0.01262126,  0.05296025, -0.08332916,  0.04616906,  0.07407425,
                -0.01691392, -0.02622538,  0.0374784 ,  0.08812574, -0.01885107,
                0.10362327, -0.16393578, -0.04819305,  0.02680854,  0.10606355,
                0.0131822 , -0.00550382,  0.02434816,  0.01151651, -0.13468221,
                -0.23103309,  0.09926207, -0.19482508,  0.0723753 ,  0.03633725,
                0.01337388, -0.13355908, -0.06974066, -0.05130261, -0.08587403,
                -0.01531071,  0.06953385,  0.02971832, -0.04122826, -0.07805257,
                0.06103304,  0.00223297,  0.04050426,  0.02221267,  0.00577133,
                -0.01638089,  0.15120113, -0.10325225, -0.06530383,  0.19862409,
                -0.02443704,  0.02965519,  0.06799526,  0.05742572,  0.19942172,
                0.11306187,  0.06325261,  0.13666704,  0.0811804 ,  0.13895239,
                0.10886019, -0.07730457,  0.04925328, -0.03156472,  0.1015344 ,
                0.13477583, -0.1496565 , -0.02072722,  0.15090448,  0.18676761,
                -0.08815354,  0.02073152,  0.1009325 , -0.09396409,  0.06160947,
                -0.02278064, -0.11005131,  0.01410492, -0.08398385, -0.04540647,
                -0.0641234 , -0.16583881, -0.1352395 , -0.03280836, -0.20041364,
                0.10643806,  0.04027498, -0.00997801, -0.02981999,  0.01284111,
                0.04330634, -0.02980369,  0.09563168, -0.10214885,  0.07861092,
                -0.15364113, -0.03379894, -0.02377984,  0.02148281,  0.10744879,
                -0.13076839,  0.11477097, -0.04806226, -0.08093853,  0.07180274,
                0.06250218, -0.06171205,  0.0637566 , -0.09040319,  0.02865938,
                -0.05606918,  0.05012723,  0.19672081,  0.0487638 ,  0.03417156,
                -0.0061427 , -0.02564177,  0.03828004, -0.02510662, -0.04564395,
                0.04649171, -0.04659481,  0.01799015};

        samples.put(0, 0, d);
        svm.predict(samples, results, 0);
        int predictedClass = (int) results.get(0, 0)[0];
        Log.d(TAG, "predicted class:" +  predictedClass);
        return predictedClass;
    }

    public void close() {
    }
}
